(function(e){var i=10,r=0.95;function t(a){var g=null,p=null,s=null,n=null,l=null,f=null,h=!1,t=null,o=[];a.hooks.processOptions.push(function(i,e){if(e.series.pie.show){e.grid.show=!1;if(e.series.pie.label.show=="auto"){if(e.legend.show){e.series.pie.label.show=!1}else{e.series.pie.label.show=!0}};if(e.series.pie.radius=="auto"){if(e.series.pie.label.show){e.series.pie.radius=3/4}else{e.series.pie.radius=1}};if(e.series.pie.tilt>1){e.series.pie.tilt=1}else if(e.series.pie.tilt<0){e.series.pie.tilt=0}}});a.hooks.bindEvents.push(function(e,i){var s=e.getOptions();if(s.series.pie.show){if(s.grid.hoverable){i.unbind("mousemove").mousemove(P)};if(s.grid.clickable){i.unbind("click").click(A)}}});a.hooks.processDatapoints.push(function(e,i,s,r){var t=e.getOptions();if(t.series.pie.show){v(e,i,s,r)}});a.hooks.drawOverlay.push(function(e,i){var s=e.getOptions();if(s.series.pie.show){I(e,i)}});a.hooks.draw.push(function(e,i){var s=e.getOptions();if(s.series.pie.show){w(e,i)}});function v(i,r,t){if(!h){h=!0;g=i.getCanvas();p=e(g).parent();s=i.getOptions();i.setData(b(i.getData()))}};function b(i){var a=0,l=0,n=0,o=s.series.pie.combine.color,p=[];for(var t=0;t<i.length;++t){var r=i[t].data;if(e.isArray(r)&&r.length==1){r=r[0]};if(e.isArray(r)){if(!isNaN(parseFloat(r[1]))&&isFinite(r[1])){r[1]=+r[1]}else{r[1]=0}}else if(!isNaN(parseFloat(r))&&isFinite(r)){r=[1,+r]}else{r=[1,0]};i[t].data=[r]};for(var t=0;t<i.length;++t){a+=i[t].data[0][1]};for(var t=0;t<i.length;++t){var r=i[t].data[0][1];if(r/a<=s.series.pie.combine.threshold){l+=r;n++;if(!o){o=i[t].color}}};for(var t=0;t<i.length;++t){var r=i[t].data[0][1];if(n<2||r/a>s.series.pie.combine.threshold){p.push(e.extend(i[t],{data:[[1,r]],color:i[t].color,label:i[t].label,angle:r*Math.PI*2/a,percent:r/(a/100)}))}};if(n>1){p.push({data:[[1,l]],color:o,label:s.series.pie.combine.label,angle:l*Math.PI*2/a,percent:l/(a/100)})};return p};function w(a,o){if(!p){return};var c=a.getPlaceholder().width(),d=a.getPlaceholder().height(),b=p.children().filter(".legend").children().width()||0;t=o;h=!1;n=Math.min(c,d/s.series.pie.tilt)/2;f=d/2+s.series.pie.offset.top;l=c/2;if(s.series.pie.offset.left=="auto"){if(s.legend.position.match("w")){l+=b/2}else{l-=b/2};if(l<n){l=n}else if(l>c-n){l=c-n}}else{l+=s.series.pie.offset.left};var g=a.getData(),v=0;do{if(v>0){n*=r};v+=1;w();if(s.series.pie.tilt<=0.8){M()}}while(!k()&&v<i)if(v>=i){w();p.prepend("<div class='error'>Could not draw pie with labels contained inside canvas</div>")};if(a.setSeries&&a.insertLegend){a.setSeries(g);a.insertLegend()};function w(){t.clearRect(0,0,c,d);p.children().filter(".pieLabel, .pieLabelBackground").remove()};function M(){var r=s.series.pie.shadow.left,a=s.series.pie.shadow.top,o=10,p=s.series.pie.shadow.alpha,e=s.series.pie.radius>1?s.series.pie.radius:n*s.series.pie.radius;if(e>=c/2-r||e*s.series.pie.tilt>=d/2-a||e<=o){return};t.save();t.translate(r,a);t.globalAlpha=p;t.fillStyle="#000";t.translate(l,f);t.scale(1,s.series.pie.tilt);for(var i=1;i<=o;i++){t.beginPath();t.arc(0,0,e,0,Math.PI*2,!1);t.fill();e-=i};t.restore()};function k(){var a=Math.PI*s.series.pie.startAngle,o=s.series.pie.radius>1?s.series.pie.radius:n*s.series.pie.radius;t.save();t.translate(l,f);t.scale(1,s.series.pie.tilt);t.save();var r=a;for(var i=0;i<g.length;++i){g[i].startAngle=r;h(g[i].angle,g[i].color,!0)};t.restore();if(s.series.pie.stroke.width>0){t.save();t.lineWidth=s.series.pie.stroke.width;r=a;for(var i=0;i<g.length;++i){h(g[i].angle,s.series.pie.stroke.color,!1)};t.restore()};u(t);t.restore();if(s.series.pie.label.show){return v()}else return!0;function h(e,i,s){if(e<=0||isNaN(e)){return};if(s){t.fillStyle=i}else{t.strokeStyle=i;t.lineJoin="round"};t.beginPath();if(Math.abs(e-Math.PI*2)>0.000000001){t.moveTo(0,0)};t.arc(0,0,o,r,r+e/2,!1);t.arc(0,0,o,r+e/2,r+e,!1);t.closePath();r+=e;if(s){t.fill()}else{t.stroke()}};function v(){var r=a,t=s.series.pie.label.radius>1?s.series.pie.label.radius:n*s.series.pie.label.radius;for(var i=0;i<g.length;++i){if(g[i].percent>=s.series.pie.label.threshold*100){if(!o(g[i],r,i)){return!1}};r+=g[i].angle};return!0;function o(i,r,n){if(i.data[0][1]==0){return!0};var M=s.legend.labelFormatter,o,k=s.series.pie.label.formatter;if(M){o=M(i.label,i)}else{o=i.label};if(k){o=k(o,i)};var v=((r+i.angle)+r)/2,b=l+Math.round(Math.cos(v)*t),w=f+Math.round(Math.sin(v)*t)*s.series.pie.tilt,A="<span class='pieLabel' id='pieLabel"+n+"' style='position:absolute;top:"+w+"px;left:"+b+"px;'>"+o+"</span>";p.append(A);var a=p.children("#pieLabel"+n),h=(w-a.height()/2),g=(b-a.width()/2);a.css("top",h);a.css("left",g);if(0-h>0||0-g>0||d-(h+a.height())<0||c-(g+a.width())<0){return!1};if(s.series.pie.label.background.opacity!=0){var u=s.series.pie.label.background.color;if(u==null){u=i.color};var P="top:"+h+"px;left:"+g+"px;";e("<div class='pieLabelBackground' style='position:absolute;width:"+a.width()+"px;height:"+a.height()+"px;"+P+"background-color:"+u+";'></div>").css("opacity",s.series.pie.label.background.opacity).insertBefore(a)};return!0}}}};function u(e){if(s.series.pie.innerRadius>0){e.save();var i=s.series.pie.innerRadius>1?s.series.pie.innerRadius:n*s.series.pie.innerRadius;e.globalCompositeOperation="destination-out";e.beginPath();e.fillStyle=s.series.pie.stroke.color;e.arc(0,0,i,0,Math.PI*2,!1);e.fill();e.closePath();e.restore();e.save();e.beginPath();e.strokeStyle=s.series.pie.stroke.color;e.arc(0,0,i,0,Math.PI*2,!1);e.stroke();e.closePath();e.restore()}};function M(e,i){for(var t=!1,s=-1,a=e.length,r=a-1;++s<a;r=s)((e[s][1]<=i[1]&&i[1]<e[r][1])||(e[r][1]<=i[1]&&i[1]<e[s][1]))&&(i[0]<(e[r][0]-e[s][0])*(i[1]-e[s][1])/(e[r][1]-e[s][1])+e[s][0])&&(t=!t);return t};function k(i,s){var h=a.getData(),p=a.getOptions(),r=p.series.pie.radius>1?p.series.pie.radius:n*p.series.pie.radius,g,u;for(var o=0;o<h.length;++o){var e=h[o];if(e.pie.show){t.save();t.beginPath();t.moveTo(0,0);t.arc(0,0,r,e.startAngle,e.startAngle+e.angle/2,!1);t.arc(0,0,r,e.startAngle+e.angle/2,e.startAngle+e.angle,!1);t.closePath();g=i-l;u=s-f;if(t.isPointInPath){if(t.isPointInPath(i-l,s-f)){t.restore();return{datapoint:[e.percent,e.data],dataIndex:0,series:e,seriesIndex:o}}}else{var c=r*Math.cos(e.startAngle),d=r*Math.sin(e.startAngle),v=r*Math.cos(e.startAngle+e.angle/4),b=r*Math.sin(e.startAngle+e.angle/4),w=r*Math.cos(e.startAngle+e.angle/2),k=r*Math.sin(e.startAngle+e.angle/2),P=r*Math.cos(e.startAngle+e.angle/1.5),A=r*Math.sin(e.startAngle+e.angle/1.5),y=r*Math.cos(e.startAngle+e.angle),m=r*Math.sin(e.startAngle+e.angle),I=[[0,0],[c,d],[v,b],[w,k],[P,A],[y,m]],O=[g,u];if(M(I,O)){t.restore();return{datapoint:[e.percent,e.data],dataIndex:0,series:e,seriesIndex:o}}};t.restore()}};return null};function P(e){c("plothover",e)};function A(e){c("plotclick",e)};function c(e,i){var n=a.offset(),h=parseInt(i.pageX-n.left),g=parseInt(i.pageY-n.top),r=k(h,g);if(s.grid.autoHighlight){for(var l=0;l<o.length;++l){var t=o[l];if(t.auto==e&&!(r&&t.series==r.series)){m(t.series)}}};if(r){y(r.series,e)};var f={pageX:i.pageX,pageY:i.pageY};p.trigger(e,[f,r])};function y(e,i){var s=d(e);if(s==-1){o.push({series:e,auto:i});a.triggerRedrawOverlay()}else if(!i){o[s].auto=!1}};function m(e){if(e==null){o=[];a.triggerRedrawOverlay()};var i=d(e);if(i!=-1){o.splice(i,1);a.triggerRedrawOverlay()}};function d(e){for(var i=0;i<o.length;++i){var s=o[i];if(s.series==e)return i};return-1};function I(i,e){var s=i.getOptions(),t=s.series.pie.radius>1?s.series.pie.radius:n*s.series.pie.radius;e.save();e.translate(l,f);e.scale(1,s.series.pie.tilt);for(var r=0;r<o.length;++r){a(o[r].series)};u(e);e.restore();function a(i){if(i.angle<=0||isNaN(i.angle)){return};e.fillStyle="rgba(255, 255, 255, "+s.series.pie.highlight.opacity+")";e.beginPath();if(Math.abs(i.angle-Math.PI*2)>0.000000001){e.moveTo(0,0)};e.arc(0,0,t,i.startAngle,i.startAngle+i.angle/2,!1);e.arc(0,0,t,i.startAngle+i.angle/2,i.startAngle+i.angle,!1);e.closePath();e.fill()}}};var s={series:{pie:{show:!1,radius:"auto",innerRadius:0,startAngle:3/2,tilt:1,shadow:{left:5,top:15,alpha:0.02},offset:{top:0,left:"auto"},stroke:{color:"#fff",width:1},label:{show:"auto",formatter:function(e,i){return"<div style='font-size:x-small;text-align:center;padding:2px;color:"+i.color+";'>"+e+"<br/>"+Math.round(i.percent)+"%</div>"},radius:1,background:{color:null,opacity:0},threshold:0},combine:{threshold:-1,color:null,label:"Other"},highlight:{opacity:0.5}}}};e.plot.plugins.push({init:t,options:s,name:"pie",version:"1.1"})})(jQuery);