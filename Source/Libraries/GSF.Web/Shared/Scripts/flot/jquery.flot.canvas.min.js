(function(t){var s={canvas:!0};var e,n,o,i=Object.prototype.hasOwnProperty;function r(s,a){var r=a.Canvas;if(e==null){n=r.prototype.getTextInfo,o=r.prototype.addText,e=r.prototype.render};r.prototype.render=function(){if(!s.getOptions().canvas){return e.call(this)};var t=this.context,v=this._textCache;t.save();t.textBaseline='middle';for(var u in v){if(i.call(v,u)){var c=v[u];for(var g in c){if(i.call(c,g)){var o=c[g],d=!0;for(var p in o){if(i.call(o,p)){var n=o[p],f=n.positions,y=n.lines;if(d){t.fillStyle=n.font.color;t.font=n.font.definition;d=!1};for(var l=0,h;h=f[l];l++){if(h.active){for(var r=0,a;a=h.lines[r];r++){t.fillText(y[r].text,a[0],a[1])}}else{f.splice(l--,1)}};if(f.length==0){delete o[p]}}}}}}};t.restore()};r.prototype.getTextInfo=function(a,i,e,v,d){if(!s.getOptions().canvas){return n.call(this,a,i,e,v,d)};var l,h,f,r;i=''+i;if(typeof e==='object'){l=e.style+' '+e.variant+' '+e.weight+' '+e.size+'px '+e.family}else{l=e};h=this._textCache[a];if(h==null){h=this._textCache[a]={}};f=h[l];if(f==null){f=h[l]={}};r=f[i];if(r==null){var p=this.context;if(typeof e!=='object'){var o=t('<div>&nbsp;</div>').css('position','absolute').addClass(typeof e==='string'?e:null).appendTo(this.getTextLayer(a));e={lineHeight:o.height(),style:o.css('font-style'),variant:o.css('font-variant'),weight:o.css('font-weight'),family:o.css('font-family'),color:o.css('color')};e.size=o.css('line-height',1).height();o.remove()};l=e.style+' '+e.variant+' '+e.weight+' '+e.size+'px '+e.family;r=f[i]={width:0,height:0,positions:[],lines:[],font:{definition:l,color:e.color}};p.save();p.font=l;var y=(i+'').replace(/<br ?\/?>|\r\n|\r/g,'\n').split('\n');for(var c=0;c<y.length;++c){var g=y[c],u=p.measureText(g);r.width=Math.max(u.width,r.width);r.height+=e.lineHeight;r.lines.push({text:g,width:u.width,height:e.lineHeight})};p.restore()};return r};r.prototype.addText=function(n,i,t,h,f,v,d,p,c){if(!s.getOptions().canvas){return o.call(this,n,i,t,h,f,v,d,p,c)};var a=this.getTextInfo(n,h,f,v,d),g=a.positions,u=a.lines;t+=a.height/u.length/2;if(c=='middle'){t=Math.round(t-a.height/2)}else if(c=='bottom'){t=Math.round(t-a.height)}else{t=Math.round(t)};if(!!(window.opera&&window.opera.version().split('.')[0]<12)){t-=2};for(var r=0,e;e=g[r];r++){if(e.x==i&&e.y==t){e.active=!0;return}};e={active:!0,lines:[],x:i,y:t};g.push(e);for(var r=0,l;l=u[r];r++){if(p=='center'){e.lines.push([Math.round(i-l.width/2),t])}else if(p=='right'){e.lines.push([Math.round(i-l.width),t])}else{e.lines.push([Math.round(i),t])};t+=l.height}}};t.plot.plugins.push({init:r,options:s,name:'canvas',version:'1.0'})})(jQuery);